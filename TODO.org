* Active Development Tasks

This file tracks active bugs, minor enhancements, and exploratory ideas.

For well-defined future features, see =specs/*-spec.md= files.
For implemented features and user stories, see =user-stories.md=.
For the main software specification, see =specs/spec.md=.

** Bugs

+ bug :: messages received before a contact was added should be fetched and displayed when the contact is added.
+ bug :: the new messages info on contacts is not reactive, and disappears too late.
+ bug :: download status does not update in a timely manner
+ amethyst sent this: =[//]: # (nip18)=
  + examine what message type that was (developer mode)
+ letter in avatar placeholder in contact details view is not centered. please compare to identity details view, where positioning is correct.

** TODO [#A] Themes (see also: specs/custom-theme-creation-spec.md, specs/theme-light-dark-variants-spec.md)

+ more fonts
+ theme generator
  + background
  + avatar
  + banner
  + reuse color theme
+ cancel/undo/revert/save
+ fonts
  + heading?
  + footer/info
  + contact/identities (headers)
  + messages self/other
+ transition when switching themes
+ light gradient
  + matching text colors
  + matching label colors
+ card corner radius
+ banner image

There are 10 background colors in the theme system:

  Layout backgrounds (5):
  1. appBg - Main application shell
  2. surfaceBg - Cards, panels, header, footer
  3. surfaceBgSubtle - Subtle surfaces (hover states)
  4. surfaceBgSelected - Selected items
  5. menuBg - Dropdown menus

  Component backgrounds (5):
  6. buttonPrimaryBg - Primary buttons
  7. buttonSecondaryBg - Secondary buttons
  8. buttonDangerBg - Danger buttons
  9. inputBg - Input fields
  10. ownBubbleBg - User's outgoing message bubbles

** TODO [#B] Code Cleanup

+ remove legacy IPC handlers (status:get, update:check, update:restart)
  + These are backward-compatibility aliases for older channel names.
  + See src/main/ipc/handlers.ts

** Enhancements

+ avatar
  + browser scrolling
  + fewer avatars per page, dynamically
  + enlarge avatars
+ banner removal
+ old messages not retrieved
+ add desktop feedback when messages arrive and app is not focused/in background
+ developer mode where messages can be inspected on double click (modal overlay); requires --dev flag
  + highlight/error log if messages are not kind 4
  + add transmission protocol (nostr or p2p)
+ allow removing identities
+ edit relays per identity
+ html/markdown messages
+ add nostling icon
+ on network connection loss during download, resume
+ banner and avatar uploads
  + either select one of the built-in avatars/banners and only send the metadata event or exchange data out of band
+ local relay

** [#C] Exploratory Ideas

+ consider browser-based application
+ add playwright mcp
+ username vs. display name
+ is the sidebar width conceptually part of a theme? if so, store it in SQLite DB
+ consider moving sub-header title into header
+ avatar next to each message (where? top, left?, own avatar as well)
+ navigate to profile view via three dots(?) and/or double click(?)
+ when navigating to about/relay/config/any menu item, deactivate contact. clicking on contact returns to chat
+ settings:
  + send with enter, line break with shift-enter
+ informative messages in footer should time out and disappear
  + consider swapping footer for info region that appears only on demand
  + consider a small, cute svg animation in footer (only an ostrich neck)
+ translations (via llm?)
+ generate custom system welcome messages once connection is established
  + the savanna is ours to conquer
  + looking forward to
  + welcome to my flock
+ enable sending images (upload where?, inline?)
+ calendar integration/display, ical
+ ensure contact list is scrollable
+ direct link
  + indicate whether a contact is online
+ search in messages
+ threads
+ mcp interface plugin
  + paid LLM on nostr
+ zaps
+ slash commands, e.g. for payments, avatar generation, etc.
+ identities
  + consider removing the alias concept for identities in favor of private profiles
  + rename identities -> profiles
+ hide/delete messages -> "x hidden messages" expand to modal
+ keyboard navigation with arrows and TAB
+ mark new messages as they arrive in main panel (when first displayed, and in visible screen)
+ avatars (generated by llm) train/distill?
+ contact online status?
  + only practical if listening to all messages sent by a contact. (last seen ... ago)
+ languages (dynamic or pre-generated?)
+ settings
  + send on enter/shift enter
+ video calls
+ spell checker
+ automatic language conversion

*** Group Chat

+ fake groups with custom message
+ add member (adding a member creates new id (deterministically?), and starts new chat)
+ @ mentions

** [#C] Build

+ disallow pushing tags on branches other than master
+ add config dir command line param

** [#C] Styling

+ larger initial screen size.
+ save screen size in config
+ vertically shrink footer
+ add splash screen with nostling
+ identities vertically by avatar?
+ enlarge sidebar on large screens

** [#C] Release

+ do NOT allow release if test, test-e2e, or lint fails
+ compress git history before version release
+ compress migrations into one initial migration
+ remove old versions
+ tidy up repo
  + find obsolete classes/functions
  + remove code smells
  + reorganize package layout
  + remove excess comments
  + consolidate tests
+ tidy up ~/Library/Application Support/nostling/
  + there may be unnecessary files

** [#C] About

+ about/docs/rationale
  + rationale :: Talk to your friends, and your friends only.
  + about :: Nostling is an easy to use, privacy focussed chat client. It uses the nostr protocol to create identies and transmit messages. On Nostr you don't need email nor registration on any platform. Create your online identies without permission.
  + docs :: private vs. public profile, mnemonic backup (portability), private vs. public key, exchanging npubs
  + technical details :: NIP-59
+ list available versions
+ release notes of latest version
+ repo
+ version
+ status

** [#C] Identity Migration

  What is Electron safeStorage?

  https://www.electronjs.org/docs/latest/api/safe-storage provides OS-native encryption where the encryption key is managed by the OS, not
   the app:

  | OS      | Backend                 | Key Storage          | Protection Scope                         |
  |---------|-------------------------|----------------------|------------------------------------------|
  | macOS   | Keychain Access         | System Keychain      | Per-app (code signature enforced)        |
  | Windows | DPAPI                   | User credentials     | Per-user (not per-app)                   |
  | Linux   | kwallet/gnome-libsecret | Desktop secret store | Varies by DE; may fall back to plaintext |

  Critical insight: The encryption key is tied to the app's identity in the OS. On macOS, if the app is reinstalled, the keychain entry
  may become orphaned/inaccessible because the new app instance gets a new keychain entry.

** [#C] Hoverinfo Controller

  Current Approach: Explicit hideInfo()

  - Caller controls both show and hide timing
  - Requires every component to remember to call hideInfo() on mouse leave
  - Component knows when its hover ends

  Alternative: Queue-based with Handler-controlled Display

  - Caller only calls showInfo(text)
  - Handler decides when/how to clear (e.g., timeout, next message, idle detection)
  - Simpler API for callers

  Middle Ground Options

  Option A: Auto-expire with optional override
  showInfo(text, { duration?: number | 'until-cleared' })
  Default auto-clears after ~300ms of no new messages.

  Option B: Message types with different behaviors
  showInfo(text, { type: 'hover' | 'feedback' })

  Option C: Last-write-wins with hysteresis (closest to current)
  showInfo(text) // shows immediately
  // Auto-clears after 300ms of inactivity (no new showInfo calls)

** TODO [#C] Backup Relays

+ add configuration for backup relays and copy incoming messages

  Key Insertion Point: src/main/nostling/service.ts in handleIncomingEvent()

  Implementation Approach: Republish raw event to backup relay after dedup check, before processing.

  What You'd Need to Add:
  1. Backup relay connection (dedicated SimplePool or extend RelayPool)
  2. Publish method (reuse existing relay-pool publish)
  3. Configuration (store backup relay URL in settings/config)

  Notes:
  - Raw event is already signed by original author
  - Content is still encrypted (NIP-04/NIP-17)
  - Republish exact same event, not create a new one
  - Make async/non-blocking to not slow down processing
